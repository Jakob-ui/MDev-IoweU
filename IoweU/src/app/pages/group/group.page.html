<ion-header [translucent]="true" class="header">
  <div class="backdrop-wrapper">
    <ion-toolbar>
      <div class="left-container" slot="start">
        <ion-icon
          [src]="iosIcons ? 'assets/icon/ionicons/ios-arrow-back.svg' : 'assets/icon/ionicons/md-arrow-back.svg'"
          class="back-button"
          (click)="goBack()"
        ></ion-icon>
      </div>

      <div class="right-container" slot="end">
        <div class="user-info" [routerLink]="'/account-settings'">
          <div class="profile-placeholder"></div>
          <span class="member-name">{{ user }}</span>
        </div>
        <ion-icon
          [src]="'assets/icon/ionicons/qr-code-outline.svg'"
          class="qr-code-icon"
          (click)="toggleQRCodeOverlay()">
        </ion-icon>

        <ion-icon
          class="edit-button"
          [src]="iosIcons ? 'assets/icon/ionicons/ios-create.svg' : 'assets/icon/ionicons/md-create.svg'"
          [routerLink]="['/edit-group', groupId]"
        ></ion-icon>
      </div>
    </ion-toolbar>
  </div>
</ion-header>

<ion-content [fullscreen]="true">
  <div
    class="qr-code-overlay"
    [ngClass]="{
      'hidden': overlayState === 'hidden',
      'normal': overlayState === 'normal',
      'start': overlayState === 'start',
      'slideUp': overlayState === 'normal',
      'slideDown': overlayState === 'hidden'
    }"
    (click)="toggleQRCodeOverlay()">
    <div class="qr-code-wrapper" (click)="$event.stopPropagation()">
      <h5>Scannen um Gruppe beizutreten.</h5>
      <qrcode [qrdata]="qrCodeValue" [width]="256"></qrcode>
      <h5>Code zum Beitreten:</h5>
      <h5 class="access-code">{{ accessCode }}</h5>
    </div>
  </div>
  <div class="page-container">
    <div class="image-upload">
      <ng-container *ngIf="group?.groupimage; else placeholder">
        <img
          [src]="group?.groupimage"
          alt="Gruppenbild"
          class="group-image"
        />
      </ng-container>
      <ng-template #placeholder>
        <div class="upload-placeholder"></div>
      </ng-template>
    </div>

    <h1>{{ groupname }}</h1>
    <div class="separator"></div>

    <ion-card
      *ngFor="let feature of features; let i = index"
      class="feature-card"
      [routerLink]="getFeatureLink(feature)"
    >
      <div class="card-content">
        <ion-card-title>{{ feature }}</ion-card-title>
        <ion-card-subtitle>
          <ng-container [ngSwitch]="feature">
            <!-- Finanzübersicht -->
            <div *ngSwitchCase="'Finanzübersicht'">
              <span
                class="myBalance"
                [ngClass]="{ 'negative': myBalance < 0, 'positive': myBalance >= 0 }"
              >
                <span *ngIf="myBalance >= 0">Mein Guthaben:</span>
                <span *ngIf="myBalance < 0">Meine Schulden:</span>
                <strong>{{ myBalance | currency: 'EUR' }}</strong>
              </span>
            </div>


            <!-- Ausgaben -->
            <div *ngSwitchCase="'Ausgaben'">
              <p>Gesamtausgaben</p>
              <h6>{{ sumTotalExpenses | currency: 'EUR' }}</h6>
            </div>

            <!-- Einkaufsliste -->
            <div *ngSwitchCase="'Einkaufsliste'">
              <p>{{ shoppingList.length }} Produkte auf der Liste.</p>
            </div>

            <!-- Anlagegüter -->
            <div *ngSwitchCase="'Anlagegüter'">
              <p>{{ assetsList.length }} Güter eingetragen.</p>
            </div>

            <!-- Standardfall -->
            <div *ngSwitchDefault>
              <p>Keine Daten verfügbar.</p>
            </div>
          </ng-container>
        </ion-card-subtitle>
      </div>
    </ion-card>

    <div class="feature-select-container" *ngIf="isFounder && canAddFeatures && features.length === 0">
      <!-- Hinweis nur anzeigen, wenn keine Features vorhanden sind -->
      <span>
        In diese Gruppe wurden noch keine Features hinzugefügt.
      </span>

      <ion-item>
        <ion-select
          placeholder="Features hinzufügen"
          multiple="true"
          (ionChange)="onFeaturesSelected($event.detail.value)"
        >
          <ion-select-option *ngFor="let f of availableFeatures" [value]="f">
            {{ f }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <span>
        Du kannst jetzt welche hinzufügen – später kannst du sie unter
        "Gruppe bearbeiten" verwalten.
      </span>
    </div>

  </div>
</ion-content>


